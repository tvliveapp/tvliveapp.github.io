<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar Mensajes a HiveMQ</title>
</head>
<body>
    <h1>Aplicación Web MQTT con HiveMQ</h1>
    <textarea id="message" placeholder="Escribe tu mensaje"></textarea>
    <button id="sendBtn">Enviar</button>

    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script>
        // Datos de conexión de tu broker HiveMQ Cloud
        const brokerUrl = 'wss://<tu-cluster-id>.mqtt.hivemq.cloud:8000';
        const clientId = 'your-client-id'; // Puedes usar un valor único aquí
        const username = 'your-username'; // Usualmente "public" o tu propio nombre
        const password = 'your-password'; // Si tu broker lo requiere

        // Conectar al broker de HiveMQ
        const client = mqtt.connect(brokerUrl, {
            clientId: clientId,
            username: username,
            password: password
        });

        client.on('connect', function () {
            console.log('Conectado al broker de HiveMQ');
            // Suscribirse a un tópico (si quieres recibir mensajes)
            client.subscribe('test/topic', function (err) {
                if (!err) {
                    console.log('Suscrito al tópico test/topic');
                }
            });
        });

        // Enviar mensajes al broker
        document.getElementById('sendBtn').onclick = function () {
            const message = document.getElementById('message').value;
            if (message) {
                client.publish('test/topic', message); // Publicar en el tópico
                console.log('Mensaje enviado:', message);
            }
        };

        // Recibir mensajes del tópico suscrito
        client.on('message', function (topic, message) {
            console.log(`Nuevo mensaje en el tópico ${topic}: ${message.toString()}`);
            // Mostrar el mensaje en la página si lo deseas
        });
    </script>
</body>
</html>
