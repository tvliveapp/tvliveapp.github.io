
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interfaz TV - HLS + N√∫meros + Categor√≠as</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <!-- Cargar Lodash desde CDN -->
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.1.0/moment.min.js"></script>

  <script src="canales.js"></script>
  <script src="server/mqttws31.js"></script>
 
<style>
  body {
    margin: 0;
    background: #000;
    overflow: hidden;
    font-family: Arial, sans-serif;
    color: white;
  }

  video {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: 0;
    background: black;
  }

  .channel-panel {
    position: fixed;
    top: 0;
    left: -420px;
    width: 400px;
    height: 100vh;
    background: rgba(0, 0, 0, 0.88);
    backdrop-filter: blur(6px);
    transition: left 0.3s ease;
    z-index: 10;
    display: flex;
    flex-direction: column;
  }

  .channel-panel.visible {
    left: 0;
  }

  .channel-header {
    flex-shrink: 0;
    padding: 10px 20px;
    display: flex;
    justify-content: flex-end;
    align-items: center;
    font-weight: bold;
    font-size: 1em;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    color: #ccc;
  }

  .category-tabs {
    display: flex;
    overflow-x: auto;
    padding: 8px 10px;
    background: rgba(255, 255, 255, 0.08);
    border-bottom: 1px solid rgba(255,255,255,0.15);
  }

  .category-tab {
    padding: 8px 15px;
    margin: 0 5px;
    border-radius: 15px;
    background: rgba(255,255,255,0.1);
    color: #aaa;
    font-size: 0.9em;
    white-space: nowrap;
    transition: background 0.3s, color 0.3s;
  }

  .category-tab.active {
    background: #1e90ff;
    color: white;
    font-weight: bold;
  }

  .channel-list {
    flex: 1;
    overflow-y: auto;
    padding: 10px 15px;
  }

  .channel-item {
    padding: 12px 15px;
    margin: 6px 0;
    border-radius: 5px;
    transition: background 0.2s, transform 0.1s;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .channel-item img {
    width: 32px;
    height: 32px;
    border-radius: 5px;
  }

  .channel-item.selected {
    background: #1e90ff;
    transform: scale(1.05);
  }

  .info-overlay {
    position: fixed;
    bottom: 40px;
    left: 40px;
    background: rgba(0, 0, 0, 0.7);
    padding: 15px 20px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
    animation: fadeIn 0.3s ease;
    z-index: 5;
  }

  .info-overlay.hidden {
    display: none;
  }

  .overlay-logo {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    object-fit: cover;
  }

  .overlay-text {
    display: flex;
    flex-direction: column;
  }

  .overlay-channel {
    font-weight: bold;
    font-size: 1.2em;
  }

  .overlay-program {
    font-size: 0.9em;
    color: #ccc;
    overflow: hidden;
    white-space: nowrap;
    animation: marquee 10s linear infinite;
  }

  @keyframes marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }

  .info {
    position: fixed;
    bottom: 10px;
    left: 20px;
    z-index: 5;
    color: rgba(255,255,255,0.7);
    font-size: 0.9em;
  }

  .number-overlay {
    position: fixed;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 4em;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 10px black;
    z-index: 20;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .number-overlay.visible {
    opacity: 1;
  }
</style>
</head>

<body>

<video id="tv-video" autoplay muted controls></video>

<div class="channel-panel" id="channel-panel">
  <div class="channel-header">
    <div id="channel-time">00:00</div>
    <span id="mqtt-status" style="margin-left:10px;color:red;">‚óè</span>
  </div>

  <div class="category-tabs" id="category-tabs"></div>
  <div class="channel-list" id="channel-list"></div>
</div>

<div class="info-overlay hidden" id="info-overlay">
  <img class="overlay-logo" id="overlay-logo" src="">
  <div class="overlay-text">
    <div class="overlay-channel" id="overlay-channel"></div>
    <div class="overlay-program" id="overlay-program"></div>
  </div>
</div>

<div class="number-overlay" id="number-overlay"></div>
<div class="info">‚¨ÖÔ∏è‚û°Ô∏è Categor√≠a | ‚Üë‚Üì Canales | ‚èé Selecciona | ‚èé Regresar | 0‚Äì9 Num√©rico</div>
<script src="mqtt.js"></script>
<script>

///////////////////////////////////////////////////////////////////
// -------- DECODIFICACI√ìN DEL STREAM (TAL COMO LO TEN√çAS) -------
///////////////////////////////////////////////////////////////////

var playbackURL = ""
    , FM = []
    , _s = "Ldy";
  FM = [[122, "VUs4NzkwMjhZSQ=="], [30, "Y3Y4NzkwNzVHaA=="], [56, "SUQ4NzkwNzFwbw=="], [131, "Ymo4NzkwMjhJTw=="], [102, "Q0s4NzkwNjlnVw=="], [23, "aVQ4NzkwNjhQSQ=="], [96, "SEQ4NzkwMjRPcw=="], [141, "aVc4NzkwMjRoVQ=="], [151, "UFI4NzkwMjhkZg=="], [123, "SWU4NzkwMjdpaA=="], [109, "bnQ4NzkwMTljUQ=="], [121, "T3I4NzkwMjVUcQ=="], [35, "QkE4NzkwODBpaw=="], [22, "Q0o4NzkwNzJrQw=="], [5, "Y2g4NzkwMjlQUg=="], [72, "WXM4NzkwMjVCZw=="], [114, "WE84NzkwMTZXRg=="], [33, "aXg4NzkwNzBmYQ=="], [127, "UkI4NzkwMjZnTQ=="], [118, "Q2g4NzkwMjFyUw=="], [132, "bVA4NzkwMjFqZw=="], [41, "bHM4NzkwNzRxRQ=="], [147, "bUQ4NzkwMjNleA=="], [73, "S2U4NzkwMjZ5eg=="], [13, "Y0w4NzkwMTdlbw=="], [28, "Smk4NzkwODladA=="], [26, "UFk4NzkwNzlPaQ=="], [117, "aUc4NzkwMjVTWA=="], [54, "aVg4NzkwNzZKcg=="], [87, "ek44NzkwMjhlRg=="], [51, "Qk04NzkwODFmTg=="], [38, "V2M4NzkwMjNpWQ=="], [43, "blA4NzkwODJ0QQ=="], [97, "QVA4NzkwNzBTRw=="], [31, "VFc4NzkwNzFMZQ=="], [60, "b3U4NzkwODBFcg=="], [136, "aGU4NzkwMDlRSQ=="], [129, "SmY4NzkwMjFZcQ=="], [124, "Y2E4NzkwMjZrRQ=="], [6, "WWg4NzkwMThIUQ=="], [110, "bGw4NzkwMTlBRA=="], [92, "aFE4NzkwNzNxdA=="], [103, "QWY4NzkwNzJTZg=="], [36, "U0s4NzkwMjl0Rg=="], [82, "bWQ4NzkwMjBRbg=="], [27, "ekM4NzkwNzZUag=="], [70, "TGM4NzkwMzJ3WQ=="], [120, "dkQ4NzkwMjNFWg=="], [34, "QXY4NzkwODJSUw=="], [75, "Y2Y4NzkwMjVPVg=="], [69, "Qm84NzkwODF5Qw=="], [25, "Qng4NzkwODZJeQ=="], [62, "Vlg4NzkwODhUWA=="], [64, "WmM4NzkwMzRoTQ=="], [149, "ZHg4NzkwMTdqSQ=="], [58, "aVc4NzkwOTF6aA=="], [106, "WW04NzkwNzBOSQ=="], [76, "YUw4NzkwMjJyRA=="], [139, "Q2w4NzkwMzJNQw=="], [50, "dno4NzkwODNRcw=="], [59, "cGw4NzkwMTdKbg=="], [48, "bEM4NzkwNzJodg=="], [89, "bUw4NzkwNzNnRw=="], [133, "UUM4NzkwMjhIZQ=="], [135, "eEU4NzkwMjZpYQ=="], [108, "U244NzkwMjZNaw=="], [138, "Q2I4NzkwODNsSg=="], [9, "Ukg4NzkwMjNtZA=="], [88, "Sko4NzkwMjJUZQ=="], [101, "blQ4NzkwMjZPVg=="], [144, "Qm84NzkwMjFqQQ=="], [95, "eEg4NzkwMjdpSw=="], [7, "eVY4NzkwMThXZg=="], [46, "eWE4NzkwNzl4Vg=="], [65, "bHQ4NzkwODdSeQ=="], [49, "Z3Y4NzkwODZsag=="], [32, "dnI4NzkwMTd1dg=="], [84, "WmY4NzkwNzJsSw=="], [39, "cWQ4NzkwMjJYWQ=="], [99, "TEw4NzkwMjNMQw=="], [83, "Y0E4NzkwMjBYbQ=="], [61, "cG04NzkwMjJKYw=="], [140, "dEU4NzkwMjNyTQ=="], [8, "amI4NzkwMjB5QQ=="], [10, "YWo4NzkwNzBmaw=="], [2, "Qmk4NzkwODdvdA=="], [146, "TlY4NzkwMTdTWQ=="], [12, "Skg4NzkwMjBwVQ=="], [71, "cFg4NzkwMjN3TQ=="], [63, "Slg4NzkwMjdhcQ=="], [16, "bVA4NzkwNjhxeQ=="], [150, "Q0c4NzkwMjdFSA=="], [113, "VVM4NzkwMjZjVQ=="], [78, "THY4NzkwMjVaag=="], [126, "WE84NzkwMjBpVQ=="], [90, "aU84NzkwMjR3dA=="], [91, "V2U4NzkwNzBNZw=="], [100, "amQ4NzkwNzBBeQ=="], [94, "d0k4NzkwMjN5dg=="], [21, "WW44NzkwODV3bQ=="], [57, "eHY4NzkwNzJhRA=="], [85, "Y2Q4NzkwNzBJTw=="], [80, "eE84NzkwNjlpag=="], [29, "ZHo4NzkwNzJYZQ=="], [115, "aFc4NzkwMjBKQw=="], [98, "RW44NzkwMjNLbA=="], [111, "U1g4NzkwMTZjZg=="], [130, "VGU4NzkwMjJIUQ=="], [15, "cEQ4NzkwODVuQg=="], [148, "clI4NzkwMjN1dA=="], [44, "Qnc4NzkwNjlCdQ=="], [11, "cEM4NzkwMjRseQ=="], [55, "aWo4NzkwODFxdA=="], [104, "WnY4NzkwNzFEbA=="], [42, "dkM4NzkwNzlCdw=="], [37, "ZWY4NzkwMjNwZA=="], [142, "b2Q4NzkwMTdBVg=="], [45, "d2I4NzkwNjhFTw=="], [143, "c044NzkwMjFndw=="], [77, "cFE4NzkwMjRrYg=="], [93, "T1Q4NzkwMjZpRA=="], [68, "RG04NzkwNzJxeg=="], [1, "cXg4NzkwODduVQ=="], [17, "TU04NzkwNzB3cQ=="], [134, "YVo4NzkwMjduTg=="], [119, "bnE4NzkwMjNhYg=="], [79, "aHE4NzkwMjR4Vg=="], [52, "R0Y4NzkwMjFLdA=="], [86, "QUY4NzkwMjBJdA=="], [14, "bmU4NzkwNzB5Zw=="], [66, "aXg4NzkwODJrWQ=="], [0, "dWM4NzkwNzV2Sg=="], [20, "Ylk4NzkwODdZaw=="], [116, "ZGw4NzkwMjZhcQ=="], [67, "Smg4NzkwNzhHTg=="], [128, "R0o4NzkwMjVjaQ=="], [112, "bGs4NzkwNjhLSQ=="], [137, "Tk04NzkwNzZpbg=="], [53, "THg4NzkwMThwTA=="], [3, "a3Y4NzkwODNVYQ=="], [24, "U0c4NzkwODB0bw=="], [4, "ZU84NzkwODZMTw=="], [105, "Snk4NzkwNzBhVg=="], [47, "cnM4NzkwMThyRw=="], [19, "ZFE4NzkwODZ2cg=="], [107, "WUs4NzkwMjRIaQ=="], [145, "eG04NzkwMjR6Qw=="], [125, "UW44NzkwMTZNTA=="], [40, "ZHc4NzkwMThzRw=="], [74, "WXc4NzkwNzFlUA=="], [81, "UFo4NzkwMjdRYg=="], [18, "WVM4NzkwNzh5Tg=="]];
          

// ORDENAR + DECODIFICAR
FM.sort((a,b)=>a[0]-b[0]);
var k = wKOnO() + xBjbE();
FM.forEach(e=>{
  let v = e[1];
  playbackURL += String.fromCharCode(parseInt(atob(v).replace(/\D/g,'')) - k);
});
function wKOnO() { return 63804; }
function xBjbE() { return 815167; }

console.log("URL final:", playbackURL);

///////////////////////////////////////////////////////////////////
// ------------------------- SETUP BASICO -------------------------
///////////////////////////////////////////////////////////////////

const video = document.getElementById('tv-video');
const panel = document.getElementById('channel-panel');
const list = document.getElementById('channel-list');
const overlay = document.getElementById('info-overlay');
const overlayLogo = document.getElementById('overlay-logo');
const overlayChannel = document.getElementById('overlay-channel');
const overlayProgram = document.getElementById('overlay-program');
const timeLabel = document.getElementById('channel-time');
const categoryTabs = document.getElementById('category-tabs');
const numberOverlay = document.getElementById('number-overlay');

// TUS CATEGOR√çAS ORIGINALES
//const categorias = [ { nombre: "TV en Vivo", canales: [ { nombre: "Canal 1 - ESPN2", programa: "Deportes en directo", video: "https://98ca2.crackstreamslivehd.com/espn2/index.m3u8?token=a156f65d787c4a63f3075b145e9a8f49ac99b0d5-df-1762446893-1762392893&ip=45.225.44.89", logo: "https://upload.wikimedia.org/wikipedia/commons/2/2f/ESPN_wordmark.svg", live: true }, { nombre: "Ecuavisa", programa: "Deportes ", video: "https://jireh-3-hls-video-us-isp.dps.live/hls-video/c54ac2799874375c81c1672abb700870537c5223/ecuavisa/ecuavisa.smil/playlist.m3u8?dpssid=40cb047aec994130144f5291784736b7&sid=ba5t1l1xb2500082414690c30e7f3ff5&ndvc=0", logo: "https://upload.wikimedia.org/wikipedia/commons/0/05/Sports_icon.svg", live: true }, { nombre: "Teleamazonas", programa: "Deportes ", video: "https://teleamazonas-live.cdn.vustreams.com/live/fd4ab346-b4e3-4628-abf0-b5a1bc192428/live.isml/live-video=6499968.m3u8", logo: "https://upload.wikimedia.org/wikipedia/commons/0/05/Sports_icon.svg", live: true }, { nombre: "ECDF", programa: "Deportes ", video: " https://ozufk.envivotv.live/ecdf/tracks-v1a1/mono.m3u8?remote=186.69.141.34&token=fd3fab079ae4c8ffa153a77d663f28ad8a54ac25-447440262ee5a9ca9df57b3fc242bc3f-1763088436-1763077636", logo: "https://upload.wikimedia.org/wikipedia/commons/0/05/Sports_icon.svg", live: true }, ] }, { nombre: "Noticias", canales: [ {nombre: "Canal 2 - Internacional", programa: "Noticias globales", video: "https://www.w3schools.com/html/mov_bbb.mp4", logo: "https://upload.wikimedia.org/wikipedia/commons/6/6c/TV_icon_2.svg"}, {nombre: "Canal 3 - Nacional", programa: "Titulares del d√≠a", video: "https://www.w3schools.com/html/movie.mp4", logo: "https://upload.wikimedia.org/wikipedia/commons/6/6c/TV_icon_2.svg"}, { nombre: "espn dinamico", programa: "√öltimas Noticias", video: playbackURL, logo: "https://upload.wikimedia.org/wikipedia/commons/8/8f/News_icon.svg", live: true } ] }, { nombre: "M√∫sica", canales: [ {nombre: "Canal 4 - Pop Hits", programa: "Top 10 del momento", video: "https://cdn.pixabay.com/video/2021/09/21/88369-615371202_large.mp4", logo: "https://upload.wikimedia.org/wikipedia/commons/8/84/Music_icon.svg"}, {nombre: "Canal 5 - Rock TV", programa: "Rock Cl√°sico", video: "https://cdn.pixabay.com/video/2023/06/13/167267-836065889_large.mp4", logo: "https://upload.wikimedia.org/wikipedia/commons/8/84/Music_icon.svg"} ] } ];

// Agregar "Todos"
//const todos = { nombre: "Todos", canales: categorias.flatMap(c => c.canales) };
//categorias.unshift(todos);

  window.addEventListener('load', function() {
    console.log('Page and all resources fully loaded!');
    // Call other functions here
    const todos = { nombre: "Todos", canales: categorias.flatMap(c => c.canales) };
categorias.unshift(todos);
});

let categoriaActual = 0;
let canalSeleccionado = 0;
let panelVisible = false;
let overlayTimeout, inactivityTimer, numberBuffer = "", numberTimer;


///////////////////////////////////////////////////////////////////
// ------------------------- REPRODUCCI√ìN -------------------------
///////////////////////////////////////////////////////////////////
/*
function playVideo(url, isLive=false) {
  if (Hls.isSupported() && url.endsWith(".m3u8")) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
  } else {
    
    video.src = url;
    video.play();
  }
}
*/


function playVideo(url, isLive = false) {
      
    // Caso 1: HLS directo (.m3u8)
    if (Hls.isSupported() && url.includes(".m3u8")) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        return;
    }

    // Caso 2: URL de los canales anteriores
    const la14hdBase = "la14hd";
    const streamtp10Base = "streamtp10";
    if (url.includes(la14hdBase) || url.includes(streamtp10Base)) {
        const data = {
        id: myId,
        cmd: "getStream",
        chnUrl: url
      };
    
        publicar("server11",JSON.stringify(data));
        
       return;
    }

    // Caso 3: Fuente de video v√°lida est√°ndar (mp4, webm)
    if (url.match(/\.(mp4|webm|ogg)$/i)) {
        video.src = url;
        video.play();
        return;
    }

    // Caso 4: URL desconocida
    console.warn("URL de video no reconocida:", url);
    
}


  ////

function generarTabs() {
  categoryTabs.innerHTML = "";
  categorias.forEach((cat, i)=>{
    const tab=document.createElement("div");
    tab.className = "category-tab" + (i===categoriaActual ? " active":"");
    tab.textContent = cat.nombre;
    categoryTabs.appendChild(tab);
  });
}

function generarLista() {
  list.innerHTML = "";
  categorias[categoriaActual].canales.forEach((canal,i)=>{
    const div=document.createElement("div");
    div.className = "channel-item" + (i===canalSeleccionado ? " selected":"");
    div.innerHTML = `<img src="${canal.logo}">${canal.nombre}`;
    list.appendChild(div);
  });
}

function updateSelection() {
  document.querySelectorAll(".channel-item").forEach((ch,i)=>
    ch.classList.toggle("selected",i===canalSeleccionado)
  );
  document.querySelectorAll(".category-tab").forEach((t,i)=>
    t.classList.toggle("active",i===categoriaActual)
  );
  document.querySelectorAll(".channel-item")[canalSeleccionado]?.scrollIntoView({
    block:"nearest",
    behavior:"smooth"
  });
}

function changeChannel() {
  const canal = categorias[categoriaActual].canales[canalSeleccionado];
  playVideo(canal.video, canal.live);
  showOverlay(canal.nombre, canal.programa, canal.logo);
}

function showOverlay(nombre, programa, logo) {
  overlayLogo.src = logo;
  overlayChannel.textContent = nombre;
  overlayProgram.textContent = programa;
  overlay.classList.remove("hidden");

  clearTimeout(overlayTimeout);
  overlayTimeout = setTimeout(()=>{
    overlay.classList.add("hidden");
  },4000);
}

function updateTime() {
  const now = new Date();
  timeLabel.textContent = now.toLocaleTimeString([],{
    hour:'2-digit',minute:'2-digit'
  });
}
setInterval(updateTime,1000);
updateTime();

generarTabs();
generarLista();


///////////////////////////////////////////////////////////////////
// --------- REGISTRO DE TECLAS PARA SAMSUNG TIZEN  --------------
///////////////////////////////////////////////////////////////////

if (typeof tizen !== "undefined" && tizen.tvinputdevice) {
  ["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Return"]
  .forEach(key=>{
    try { tizen.tvinputdevice.registerKey(key); } catch(e){}
  });
}

///////////////////////////////////////////////////////////////////
// --------------------- CONTROL POR TECLAS -----------------------
///////////////////////////////////////////////////////////////////

function resetInactivityTimer() {
  clearTimeout(inactivityTimer);
  if (panelVisible) {
    inactivityTimer = setTimeout(()=>{
      panelVisible=false;
      panel.classList.remove("visible");
    },5000);
  }
}

document.addEventListener("keydown",(e)=>{

  resetInactivityTimer();

  
  // N√∫meros 0‚Äì9
  if (code >= 48 && code <= 57) {
    const digit = String.fromCharCode(code);
    numberBuffer += digit;
    numberOverlay.textContent = numberBuffer;
    numberOverlay.classList.add("visible");

    clearTimeout(numberTimer);
    numberTimer = setTimeout(()=>{
      const num = parseInt(numberBuffer);
      const todosCanales = categorias[0].canales;
      if (num > 0 && num <= todosCanales.length) {
        canalSeleccionado = num - 1;
        categoriaActual = 0;
        generarTabs();
        generarLista();
        changeChannel();
      }
      numberBuffer = "";
      numberOverlay.classList.remove("visible");
    },1300);
    return;
  }


  // FLECHAS, ENTER Y RETURN ‚Äî COMPATIBLE TIZEN
 
  switch(code) {
    case 37: // ‚Üê
      if (!panelVisible) {
        panelVisible=true;
        panel.classList.add("visible");
      } else {
        categoriaActual = (categoriaActual - 1 + categorias.length) % categorias.length;
        canalSeleccionado = 0;
        generarTabs();
        generarLista();
      }
      break;

    case 39: // ‚Üí
      if (panelVisible) {
        categoriaActual = (categoriaActual + 1) % categorias.length;
        canalSeleccionado = 0;
        generarTabs();
        generarLista();
      }
      break;

    case 38: // ‚Üë
      canalSeleccionado = (canalSeleccionado - 1 + categorias[categoriaActual].canales.length) %
                          categorias[categoriaActual].canales.length;
      updateSelection();
      if (!panelVisible) changeChannel();
      break;

    case 40: // ‚Üì
      canalSeleccionado = (canalSeleccionado + 1) %
                          categorias[categoriaActual].canales.length;
      updateSelection();
      if (!panelVisible) changeChannel();
      break;

    case 13: // ENTER
      changeChannel();
      break;

    case 10009: // RETURN (Samsung)
      panelVisible=false;
      panel.classList.remove("visible");
      overlay.classList.add("hidden");
      break;
  }
/*
  switch(key) {

  case "ArrowLeft":
    if (!panelVisible) {
      panelVisible=true;
      panel.classList.add("visible");
    } else {
      categoriaActual = (categoriaActual - 1 + categorias.length) % categorias.length;
      canalSeleccionado = 0;
      generarTabs();
      generarLista();
    }
    break;

  case "ArrowRight":
    if (panelVisible) {
      categoriaActual = (categoriaActual + 1) % categorias.length;
      canalSeleccionado = 0;
      generarTabs();
      generarLista();
    }
    break;

  case "ArrowUp":
    canalSeleccionado = (canalSeleccionado - 1 + categorias[categoriaActual].canales.length) %
                        categorias[categoriaActual].canales.length;
    updateSelection();
    if (!panelVisible) changeChannel();
    break;

  case "ArrowDown":
    canalSeleccionado = (canalSeleccionado + 1) %
                        categorias[categoriaActual].canales.length;
    updateSelection();
    if (!panelVisible) changeChannel();
    break;

  case "Enter":
    changeChannel();
    break;

  case "Backspace":   // üî• LG usa Backspace
  case "Escape":
    panelVisible=false;
    panel.classList.remove("visible");
    overlay.classList.add("hidden");
    break;
}
*/
  updateSelection();
});

  ///////////////////////////////////////////////////////////////////
// -------------------- CONTROL T√ÅCTIL (ANDROID) -----------------
///////////////////////////////////////////////////////////////////

let touchStartX = 0;
let touchStartY = 0;
let touchEndX = 0;
let touchEndY = 0;

document.addEventListener("touchstart", (e) => {
  touchStartX = e.changedTouches[0].screenX;
  touchStartY = e.changedTouches[0].screenY;
});

document.addEventListener("touchend", (e) => {
  touchEndX = e.changedTouches[0].screenX;
  touchEndY = e.changedTouches[0].screenY;
  handleGesture();
});

function handleGesture() {
  const dx = touchEndX - touchStartX;
  const dy = touchEndY - touchStartY;

  const minSwipeDistance = 50; // sensibilidad

  // Swipe Horizontal
  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > minSwipeDistance) {
      // üëâ Swipe derecha (como flecha derecha)
      if (panelVisible) {
        categoriaActual = (categoriaActual + 1) % categorias.length;
        canalSeleccionado = 0;
        generarTabs();
        generarLista();
      }
    } else if (dx < -minSwipeDistance) {
      // üëâ Swipe izquierda (como flecha izquierda)
      if (!panelVisible) {
        panelVisible = true;
        panel.classList.add("visible");
      } else {
        categoriaActual = (categoriaActual - 1 + categorias.length) % categorias.length;
        canalSeleccionado = 0;
        generarTabs();
        generarLista();
      }
    }
  }

  // Swipe Vertical
  else {
    if (dy > minSwipeDistance) {
      // üëá Swipe abajo (canal siguiente)
      canalSeleccionado = (canalSeleccionado + 1) %
        categorias[categoriaActual].canales.length;
      updateSelection();
      if (!panelVisible) changeChannel();
    } 
    else if (dy < -minSwipeDistance) {
      // üëÜ Swipe arriba (canal anterior)
      canalSeleccionado = (canalSeleccionado - 1 +
        categorias[categoriaActual].canales.length) %
        categorias[categoriaActual].canales.length;
      updateSelection();
      if (!panelVisible) changeChannel();
    }
  }
}


///////////////////////////////////////////////////////////////////
// -------- REPRODUCIR PRIMER CANAL AL INICIAR -------------------
///////////////////////////////////////////////////////////////////

changeChannel();
vid="https://ozufk.envivotv.live/ecdf/tracks-v1a1/mono.m3u8?remote=186.69.141.34&token=fd3fab079ae4c8ffa153a77d663f28ad8a54ac25-447440262ee5a9ca9df57b3fc242bc3f-1763088436-1763077636";
playVideo(vid,true);



////mqtt message received
 function  mqttMessage(payloadString){
    data= JSON.parse(payloadString);
   if(data.cmd=="playStream"){
       playVideo(data.streamUrl,true);
       return;
   }
   
 }



  async function getLocalIP() {
  return new Promise((resolve, reject) => {
    const pc = new RTCPeerConnection({iceServers: []});
    pc.createDataChannel('');
    pc.createOffer().then(offer => pc.setLocalDescription(offer));
    pc.onicecandidate = (event) => {
      if (!event.candidate) return;
      const ipMatch = event.candidate.candidate.match(/(\d{1,3}(\.\d{1,3}){3})/);
      if (ipMatch) {
        resolve(ipMatch[1]);
        pc.close();
      }
    };
  });
}

getLocalIP().then(ip => console.log("Mi IP local:", ip));

  
</script>
</body>
</html>
