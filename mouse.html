<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gesto doble con pausa seguro</title>
<style>
  body { margin:0; background:black; color:white; font-family:Arial,sans-serif; }
  video { width:100vw; height:100vh; object-fit:cover; display:block; }
  .coords { position:fixed; top:20px; left:20px; background:rgba(0,0,0,0.6); padding:8px 12px; border-radius:6px; font-size:1em; }
  .increment { position:fixed; top:60px; left:20px; background:rgba(0,0,0,0.6); padding:8px 12px; border-radius:6px; font-size:1em; }
  .channel-change { position:fixed; top:100px; left:20px; background:rgba(0,0,0,0.6); padding:8px 12px; border-radius:6px; font-size:1em; }
</style>
</head>
<body>

<video id="tv-video" autoplay muted loop>
  <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
</video>

<div class="coords" id="coords">Y: 0</div>
<div class="increment" id="increment">Incremento actual: 0</div>
<div class="channel-change" id="channelChange">Movimiento canal: 0</div>

<script>
// --- Canales de prueba
const categorias = [{nombre:"Todos", canales:[
  {nombre:"Canal 1", video:"https://www.w3schools.com/html/mov_bbb.mp4"},
  {nombre:"Canal 2", video:"https://www.w3schools.com/html/movie.mp4"},
  {nombre:"Canal 3", video:"https://www.w3schools.com/html/mov_bbb.mp4"}
]}];

let canalSeleccionado = 0;
const video = document.getElementById("tv-video");
const coords = document.getElementById("coords");
const incrementLabel = document.getElementById("increment");
const channelLabel = document.getElementById("channelChange");

function playChannel(movement = 0) {
  video.src = categorias[0].canales[canalSeleccionado].video;
  video.play();
  channelLabel.textContent = `Canal actual: ${canalSeleccionado + 1}  Movimiento: ${movement>0?"+":"-"}${Math.abs(movement)}`;
}
playChannel(0);

// --- Gestos cortos consecutivos
const MAX_INCREMENT = 35;      // incremento máximo permitido para detectar
const MIN_INCREMENT = 10;      // incremento mínimo para contar como gesto
const MAX_INTERVAL = 1000;     // intervalo máximo entre dos gestos en ms

let lastGestureDirection = null;  
let lastGestureTime = null;      
let gestureStartY = null;        
let gestureStartTime = null;     

document.addEventListener("mousemove", (e)=>{
  const now = Date.now();
  coords.textContent = `Y: ${e.clientY}`;

  if(gestureStartY === null){
    gestureStartY = e.clientY;
    gestureStartTime = now;
    incrementLabel.textContent = `Incremento actual: 0`;
    return;
  }

  const deltaY = e.clientY - gestureStartY;
  const absDeltaY = Math.abs(deltaY);
  const duration = now - gestureStartTime;

  // Reset si el movimiento es largo o lento → NO cambiar canal
  if(absDeltaY > MAX_INCREMENT || duration > MAX_INTERVAL){
    gestureStartY = e.clientY;
    gestureStartTime = now;
    incrementLabel.textContent = `Incremento actual: 0`;
    lastGestureDirection = null;
    lastGestureTime = null;
    channelLabel.textContent = `Movimiento canal: 0`;
    return;
  }

  // Mostrar incremento solo si es suficiente
  if(absDeltaY >= MIN_INCREMENT){
    incrementLabel.textContent = `Incremento actual: ${deltaY.toFixed(0)}`;
    const direction = deltaY < 0 ? "up" : "down";

    if(lastGestureDirection === direction && lastGestureTime && (now - lastGestureTime <= MAX_INTERVAL)){
      // Segundo gesto dentro del tiempo → cambiar canal
      const movement = direction === "up" ? -1 : 1;
      canalSeleccionado = (canalSeleccionado + movement + categorias[0].canales.length) % categorias[0].canales.length;
      playChannel(movement);

      // Reset para detectar el siguiente gesto
      lastGestureDirection = null;
      lastGestureTime = null;
    } else {
      // Primer gesto detectado
      lastGestureDirection = direction;
      lastGestureTime = now;
      channelLabel.textContent = `Movimiento canal: ${direction==="up"? "-":"+"}`;
    }
  }

  gestureStartY = e.clientY;
  gestureStartTime = now;
});
</script>
</body>
</html>
